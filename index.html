<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Private Photo App</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body{font-family:Arial;text-align:center}
    img{width:120px;margin:8px}
  </style>
</head>
<body>

<h2>Login / Register</h2>
<input type="email" id="email" placeholder="Email"><br><br>
<input type="password" id="password" placeholder="Password"><br><br>
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>

<hr>

<h2>Upload Photo</h2>
<input type="file" id="file"><br><br>
<button onclick="upload()">Upload</button>

<div id="gallery"></div>

<script>
const supabase = window.supabase.createClient(
  "https://fvmbskiigmlnbpiiiczo.supabase.co",
  "sb_publishable_ttQ3nqatwhwxP2DQNBysZA_Wirqe4Gh"
);

async function register(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await supabase.auth.signUp({ email, password });
  alert("Registered! Check email if needed.");
}

async function login(){
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  await supabase.auth.signInWithPassword({ email, password });
  alert("Login Success");
  loadImages();
}

async function upload(){
  const file = document.getElementById("file").files[0];
  const user = (await supabase.auth.getUser()).data.user;
  const { error } = await supabase.storage
    .from("photos")
    .upload(user.id + "/" + file.name, file, { upsert:true });
  if(!error){ alert("Uploaded"); loadImages(); }
}

async function loadImages(){
  const user = (await supabase.auth.getUser()).data.user;
  const { data } = await supabase.storage
    .from("photos")
    .list(user.id);
  const gallery = document.getElementById("gallery");
  gallery.innerHTML="";
  for(const file of data){
    const { data:urlData } = supabase.storage
      .from("photos")
      .getPublicUrl(user.id + "/" + file.name);
    const img = document.createElement("img");
    img.src = urlData.publicUrl;
    gallery.appendChild(img);
  }
}
</script>

</body>
</html>
